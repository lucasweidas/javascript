<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Velha</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        <div class="container">
            <div class="jogador-c">
                <p id="jogador">Jogador atual: <span>X</span></p>
            </div>
            <div class="jogo">
                <button class="btn">1</button>
                <button class="btn">2</button>
                <button class="btn">3</button>
                <button class="btn">4</button>
                <button class="btn">5</button>
                <button class="btn">6</button>
                <button class="btn">7</button>
                <button class="btn">8</button>
                <button class="btn">9</button>
            </div>
            <button id="btn-reset">Resetar</button>
        </div>
    </main>

    <script>
        function fillArray() {
            return [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
        }

        function verificarJogada(buttonValue, button) {
            if (buttonValue != "X" && buttonValue != "O" && !fim) {
                novaJogada(buttonValue, button)
            }
        }

        function novaJogada(buttonValue, button) {
            const jogadorValue = jogador.innerText;
            for (let c = 0; c < 3; c++) {
                for (let i = 0; i < 3; i++) {
                    if (posicoes[c][i] == buttonValue) {
                        posicoes[c][i] = jogadorValue
                    }
                }
            }
            button.classList.add("selected")
            button.innerText = jogadorValue
            if (verificarFim(jogadorValue)) {
                return
            }
            mudarJogador(jogadorValue)
        }

        function mudarJogador(jogadorValue) {
            if (jogadorValue == "X") {
                jogador.innerText = "O"
            } else {
                jogador.innerText = "X"
            }
        }

        function verificarFim(jogadorValue) {
            console.log("verificando")
            let linha = 0;
            let coluna = 0;
            for (let c = 0; c < 3; c++) {
                for (let l = 0; l < 3; l++) {
                    // Verifica final em coluna
                    if (posicoes[l][c] == jogadorValue) {
                        coluna++
                    }
                    // Verifica final em linha
                    if (posicoes[c][l] == jogadorValue) {
                        linha++
                    }
                }
                if (linha === 3) {
                    console.log(`linha: ${posicoes}`)
                    return fim = true
                } else if (coluna === 3) {
                    console.log(`coluna: ${posicoes}`)
                    return fim = true
                }
                linha = 0
                coluna = 0
            }
            // Verifica final na diÃ¡gonal
            if (posicoes[0][0] == jogadorValue && posicoes[1][1] == jogadorValue && posicoes[2][2] == jogadorValue) {
                console.log(`diagonal 1: ${posicoes}`)
                return fim = true
            } else if (posicoes[0][2] == jogadorValue && posicoes[1][1] == jogadorValue && posicoes[2][0] == jogadorValue) {
                console.log(`diagonal 2: ${posicoes}`)
                return fim = true
            }
        }

        function resetar() {
            fim = false
            jogador.innerText = "X"
            posicoes = fillArray()
            let num = 1;
            buttons.forEach(button => {
                button.classList.remove("selected")
                button.innerText = num++
            })
        }

        const buttons = document.querySelectorAll(".btn")
        const reset = document.querySelector("#btn-reset")
        const jogador = document.querySelector("#jogador span")
        let posicoes = fillArray()
        let fim = false

        buttons.forEach(button => {
            button.addEventListener("click", () => {
                const buttonValue = button.innerText
                verificarJogada(buttonValue, button)
            })
        })

        reset.addEventListener("click", resetar);
    </script>
</body>
</html>